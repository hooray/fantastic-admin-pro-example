
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.netlify.app
 * 代码仓库
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
    
import{d as e,r as t,y as i,o as n,b as o,f as a,l as s,E as l,a7 as r,h as c,w as d,bP as u,bT as h,bQ as g,G as f,m as p,Y as v,L as m}from"./index.45a1a0f2.js";const w=["id","onMousedown","onMousemove","onMouseup","onMouseleave","onTouchstart","onTouchmove","onTouchend"],W=e({name:"SignCanvas"}),y=Object.assign(W,{props:{image:{required:!1,type:[String],default:null},options:{required:!1,type:[Object],default:()=>null}},emits:["confirm"],setup(e,{expose:l,emit:r}){const c=e,d=t(`sign-canvas-${Math.random().toString(36).substr(2)}`),u=t(null);let h=null,g=null,f=1,p={isFullScreen:!1,isFullCover:!1,isDpr:!1,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"round",canvasWidth:600,canvasHeight:600,isShowBorder:!0,bgColor:"#fcc",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!1,imgType:"png"},v=null;function m(){const e=c.options;if(e)for(const t in e)p[t]=e[t];f="undefined"!=typeof window&&p.isDpr&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio)||1,h=document.getElementById(d.value),g=h.getContext("2d"),h.style.background=p.bgColor,p.isFullScreen&&(p.canvasWidth=window.innerWidth||document.body.clientWidth,p.canvasHeight=window.innerHeight||document.body.clientHeight,p.isFullCover&&(h.style.position="fixed",h.style.top=0,h.style.left=0,h.style.margin=0,h.style.zIndex=20001)),h.height=p.canvasWidth,h.width=p.canvasHeight,h.width=p.canvasWidth*f,h.height=p.canvasHeight*f,h.style.width=`${p.canvasWidth}px`,h.style.height=`${p.canvasHeight}px`,p.emptyCanvas=h.toDataURL(`image/${p.imgType}`),C()}function W(e){p.isWrite=!0,p.lastWriteTime=(new Date).getTime(),p.lastPoint=e,g.beginPath(),g.strokeStyle=p.writeColor,g.lineCap=p.lineCap,g.lineJoin=p.lineJoin}function y(e){g.beginPath(),g.moveTo(p.lastPoint.x*f,p.lastPoint.y*f),g.lineTo(e.x*f,e.y*f),function(){const e=(new Date).getTime(),t=e-p.lastWriteTime;p.lastWriteTime=e;let i=p.minWriteWidth+(p.maxWriteWidth-p.minWriteWidth)*t/30;if(i<p.minWriteWidth?i=p.minWriteWidth:i>p.maxWriteWidth&&(i=p.maxWriteWidth),i=i.toFixed(2),p.isSign)g.lineWidth=p.writeWidth*f;else{const e=p.lastWriteWidth=p.lastWriteWidth/4*3+i/4;g.lineWidth=e*f}}(),g.stroke(),p.lastPoint=e,g.closePath()}function T(e){p.isWrite=!1,p.lastPoint=e,x()}function C(){g.save(),g.strokeStyle=p.writeColor,g.clearRect(0,0,h.width,h.height),g.beginPath(),g.lineWidth=p.borderWidth*f,g.strokeStyle=p.borderColor;let e=p.borderWidth/2*f;p.isShowBorder&&(g.moveTo(e,e),g.lineTo(h.width-e,e),g.lineTo(h.width-e,h.height-e),g.lineTo(e,h.height-e),g.closePath(),g.stroke()),p.isShowBorder&&!p.isSign&&(g.moveTo(0,0),g.lineTo(h.width,h.height),g.lineTo(h.width,h.height/2),g.lineTo(0,h.height/2),g.lineTo(0,h.height),g.lineTo(h.width,0),g.lineTo(h.width/2,0),g.lineTo(h.width/2,h.height),g.stroke()),r("confirm",null),g.restore()}function x(){const e=new Image;return e.src=h.toDataURL(`image/${p.imgType}`),r("confirm",e.src),e.src}function b(e){W({x:e.offsetX||e.clientX,y:e.offsetY||e.clientY})}function S(e){p.isWrite&&y({x:e.offsetX,y:e.offsetY})}function P(e){T({x:e.offsetX,y:e.offsetY})}function k(e){p.isWrite=!1,p.lastPoint={x:e.offsetX,y:e.offsetY}}function Y(e){const t=e.targetTouches[0];W({x:t.clientX?t.clientX-R().left:t.pageX-E(t.target,"left"),y:t.clientY?t.clientY-R().top:t.pageY-E(t.target,"top")})}function D(e){const t=e.targetTouches[0],i=t.clientX?t.clientX-R().left:t.pageX-E(t.target,"left"),n=t.clientY?t.clientY-R().top:t.pageY-E(t.target,"top");p.isWrite&&y({x:i,y:n})}function X(e){const t=e.targetTouches,i=e.changedTouches,n=t&&t.length&&t[0]||i&&i.length&&i[0];T({x:n.clientX?n.clientX-R().left:n.pageX-E(n.target,"left"),y:n.clientY?n.clientY-R().top:n.pageY-E(n.target,"top")})}function R(){return u.value.getBoundingClientRect()}function E(e,t){const i="offset"+t[0].toUpperCase()+t.substring(1);let n=e[i],o=e.offsetParent;for(;null!=o;)n+=o[i],o=o.offsetParent;return n}return i((()=>c.options),(()=>m()),{deep:!0}),n((()=>{m(),window.addEventListener("resize",(()=>{v&&clearTimeout(v),v=setTimeout((()=>{m()}),100)}))})),l({canvasClear:C,saveAsImg:x,downloadSignImg:function(e){!function(e,t){const i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=e,i.download=t;const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)}(document.getElementById(d.value).toDataURL("image/png"),e?`${e}.${p.imgType}`:`${Date.parse(new Date)}.${p.imgType}`)},dealImage:function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=300,e.width=200;const i=document.getElementById(d.value).toDataURL("image/png");t.clearRect(0,0,e.width,e.height),t.drawImage(i,0,0,e.width,e.height),e.toDataURL("image/jpeg",.6)}}),(e,t)=>(o(),a("canvas",{id:d.value,ref:u.value,class:"app-sign-canvas",onMousedown:s(b,["prevent","stop"]),onMousemove:s(S,["prevent","stop"]),onMouseup:s(P,["prevent","stop"]),onMouseleave:s(k,["prevent","stop"]),onTouchstart:s(Y,["prevent","stop"]),onTouchmove:s(D,["prevent","stop"]),onTouchend:s(X,["prevent","stop"])}," 您的浏览器不支持canvas技术,请升级浏览器! ",40,w))}}),T=f("p",null,"SignCanvas 三方组件",-1),C=f("p",{style:{"margin-bottom":"0"}},"该组件可用于电子合同签订等在线签名使用场景",-1),x=v(" 组件仓库地址 "),b=v("清除画板"),S=v("生成图片"),P=v("下载图片"),k=["src","width","height"],Y={__name:"sign.canvas.demo",setup(e){const i=t(),n=t(""),s=t({isDpr:!0,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"bevel",canvasWidth:500,canvasHeight:250,isShowBorder:!1,bgColor:"#fee",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!0,imgType:"png"});function u(){i.value.canvasClear()}function v(){n.value=i.value.saveAsImg()}function w(){i.value.downloadSignImg()}return(e,t)=>{const W=m,Y=l,D=r,X=h,R=y,E=g;return o(),a("div",null,[c(X,{title:"电子签名"},{content:d((()=>[T,C])),default:d((()=>[c(D,{onClick:t[0]||(t[0]=e=>{return t="https://github.com/langyuxiansheng/vue-sign-canvas",void window.open(t,"top");var t})},{icon:d((()=>[c(Y,null,{default:d((()=>[c(W,{name:"i-ep:link"})])),_:1})])),default:d((()=>[x])),_:1})])),_:1}),c(E,null,{default:d((()=>[c(R,{ref_key:"signCanvasRef",ref:i,options:s.value},null,8,["options"]),f("div",null,[c(D,{onClick:u},{default:d((()=>[b])),_:1}),c(D,{onClick:v},{default:d((()=>[S])),_:1}),c(D,{onClick:w},{default:d((()=>[P])),_:1})]),n.value?(o(),a("img",{key:0,src:n.value,width:s.value.canvasWidth,height:s.value.canvasHeight},null,8,k)):p("v-if",!0)])),_:1})])}}};"function"==typeof u&&u(Y);export{Y as default};
